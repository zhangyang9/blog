七层 tengine vhost 配置
server
{
	listen  80;
	server_name huati.weibo.com topic.weibo.com shuo.weibo.com;
	error_page  500 502 503 504  /502A.html;
        set $log_uid '';
        #access_log  /data1/www/logs/huati.weibo.com-access_log  main;
        error_log   /data1/www/logs/huati.weibo.com-error_log;

        # 5XX error
        location = /502A.html {
                root /data1/www/htdocs/5xx.weibo.com;
                access_log  /data1/www/logs/huati.weibo.com-500-access_log  main;
        }

        location  /z/ {
                proxy_set_header Host $host;
                proxy_set_header X-Forwarded-For $x_forwarded_for;
                proxy_set_header X-Forwarded-Port $remote_port;   #remote_port 客户端端口
                proxy_pass http://DPOOL-Z-WEIBO-COM;
        }

        location ~* /zt/ {
                  proxy_set_header Host "service.weibo.com";
                  proxy_set_header X-Host $host;
		  proxy_set_header X-Forwarded-For $x_forwarded_for;
                  proxy_pass http://CG-G0-8001-YF;
        }

        #location = /tv$ {
        #          proxy_set_header Host "tv.weibo.com";
        #          proxy_set_header X-Host $host;
	#	  proxy_set_header X-Forwarded-For $x_forwarded_for;
        #          proxy_pass http://CONTENT-G0;
        # }

        #location  ~* ^(/topic/|/about|/papp/|/pk/|/aj/|/pappedit)  {
        location ~* ^(/topic/|/about|/papp/|/pk/|/aj/|/pappedit|/super/publisher) {
                  #access_by_lua_file /usr/local/sinasrv2/etc/lua/huati_uid_php7_check.lua;
                  proxy_set_header Host "new.huati.weibo.com";
                  proxy_set_header X-Host $host;
                  proxy_set_header X-Forwarded-For $x_forwarded_for;
                  proxy_pass http://HUATI-PHP7-YF;
       }

       location @php7uidpass {
                  proxy_set_header Host "new.huati.weibo.com";
                  proxy_set_header X-Host $host;
                  proxy_set_header X-Forwarded-For $x_forwarded_for;
                  proxy_pass http://HUATI-UID-PHP7;
       }

       location  / {
                  #access_by_lua_file /usr/local/sinasrv2/etc/lua/huati_uid_php54_check.lua;
                  proxy_set_header Host $host;
		  proxy_set_header X-Forwarded-For $x_forwarded_for;
                  proxy_pass http://HUATI-PHP54;
       }

       location @php54uidpass {
                  proxy_set_header Host $host;
                  proxy_set_header X-Forwarded-For $x_forwarded_for;
                  proxy_pass http://HUATI-UID-PHP54;
       }

}