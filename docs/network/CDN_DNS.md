# DNS 原理
### DNS 设计目的
* 能够指明网络地址、路由等信息
* 分布式存储（确保数据正确性，可缓存）
* 数据格式支持多协议传输（ftp ssh rsync SQL 等）

### 迭代查询和递归查询
* 递归查询： DNS服务器必须给请求者一个"yes or no"的回答，一般电脑客户端使用递归查询
* 迭代查询： DNS服务器返回给请求者一个其他能够解析该域名的DNS服务器，依次循环直到返回结果
![](../pictures/DNS解析.png)

### 动态域名和静态域名
* 动态DNS：同一个域名会在不同时间返回不同的解析结果（动态变化的，即没有固定的ip)
* 静态DNS：一个域名的解析结果是固定的，但并不唯一，可能轮询（有固定的解析资源记录）


# CDN 原理
### CDN 作用
CDN: 内容分发网络 （content delivery network）    
将内容提供商的数据，以最快捷的方式放到距离最终用户最近的地方，节省数据的重复传输的时间。
### CDN 调度方法 、优缺点及使用场景
##### DNS 调度方法有两种：
* DNS调度  
* 302 调度
##### 优缺点：
* DNS的优点：DNS系统是天然的分布式结构客户端本机，LDNS都可以实现cache，架构本身就能实现高的伸缩性和性能
* DNS的缺点：DNS并不是为GSLB设计的GSLB 基于 local DNS的地址判断，粒度较粗。而且LDNS可能和end user网络距离很远。用户可能会设置错误的Local DNS，该服务器和用户实际距离较远，比如8.8.8.8等(edns-client-subnet可以部分解决该问题)DNS请求里面不会带有内容信息，GSLB只能拥有LDNS ip信息，无法针对内容作出更加灵活的判断因为DNS reply TTL，所以某个用户一段时间内的请求都会导向同一个site (解决：趋向于较短的TTL) 因为local dns缓存和TTL的存在，你很难判断某次的返回会对负载有多大影响某些Local DNS会忽略DNS TTL信息，而采用固定的TTL时间，对此我们无能为力电信系统倾向于直接使用ip地址访问，不使用域名
* 302的优点：可以直接得到end user ip和内容的地址，可以做出精确的redirect每个请求都需要访问GSLB,可以做出单独的处理可以在一个点方便的作出统计和认证
* 302的缺点：需要应用层协议支持(http / rtsp)一般有重定向次数限制GSLB需要处理较多的请求，却没有LDNS作为cacheGSLB暴露给end user ， 容易遭受攻击用户访问GSLB本身就会带来时延，可能深圳的用户需要访问北京的GSLB单点故障(可以通过GSLB服务群集解决)某些应用对URL变化敏感，比如WEB某些客户端支持不好(中文字符集等问题)
##### 使用场景：
dns 调度默认做了一个假设，即大家都使用localdns，localdns替你去访问全局负载均衡，但dns 大多数情况下是不支持ip透传的，只能根据查询的源ip进行调度，所以当你使用了一个其他省市的dns很可能被调度到其他省市的节点。假设你身在北京，使用了成都的dns，通常你的请求会被调度到了成都周边的节点，但显然从北京访问成都的效果并不会特别的好，所以为了消除localdns调度带来的偏差，会做一次重分配，通过你的接入ip判断，哎呀这货来自北京，我是成都唉，访问我肯定慢啊，然他去访问北京附近的节点吧，于是，产生了一个302调度。会给你一个北京附近的节点。同时这里也产生了一个问题，当一个文件比较小的时候一个302的延时甚至可能大于直接从一个较远的节点获取文集的延时，所以通常大文件会做302调度，具体判断标准一般来说视频压缩包，默认就会被认为是大文件，即使他很小，因为是基于后缀判断的。还有一种情况也是会使用302的，比如北京附近一共有8个节点被划为一组节点，但是面对动不动就是几个G的视频文件，为了节约资源，减少冗余，通常只有少数节点会缓存该视频，而dns通常会返回几个可用的节点ip但是当访问的节点不存在该视频的时候，会产生一个302调转，到一个存在该视频的节点，这个是从提高设备利用率的角度去解释302的合理性。




